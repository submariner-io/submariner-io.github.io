<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.71.0" />
    <meta name="description" content="Documentation website for the Submariner project">
<meta name="author" content="The Submariner community">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>External Network (Experimental) :: Submariner k8s project documentation website</title>

    
    <link href="/css/nucleus.css?1665163724" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1665163724" rel="stylesheet">
    <link href="/css/hybrid.css?1665163724" rel="stylesheet">
    <link href="/css/featherlight.min.css?1665163724" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1665163724" rel="stylesheet">
    <link href="/css/auto-complete.css?1665163724" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1665163724" rel="stylesheet">
    <link href="/css/theme.css?1665163724" rel="stylesheet">
    <link href="/css/hugo-theme.css?1665163724" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1665163724" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1665163724"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<link href="/css/fixes.css?1665163724" rel="stylesheet">

  </head>
  <body class="" data-url="/getting-started/quickstart/external/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" style="display: block;">
    <object data="/images/logo-submariner.svg" type="image/svg+xml" style="pointer-events: none;">
        <span>Your browser doesn't support SVG images</span>
    </object>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1665163724"></script>
<script type="text/javascript" src="/js/auto-complete.js?1665163724"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1665163724"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/getting-started/" title="Getting Started" class="dd-item 
        parent
        
        
        ">
      <a href="/getting-started/">
          <b>1. </b>Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/" title="Architecture" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/">
          Architecture
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/broker/" title="Broker" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/broker/">
          Broker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/gateway-engine/" title="Gateway Engine" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/gateway-engine/">
          Gateway Engine
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/service-discovery/" title="Service Discovery" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/service-discovery/">
          Service Discovery
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/globalnet/" title="Globalnet Controller" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/globalnet/">
          Globalnet Controller
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/networkplugin-syncer/" title="Network Plugin Syncer" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/networkplugin-syncer/">
          Network Plugin Syncer
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/networkplugin-syncer/ovn-kubernetes/" title="OVN Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/networkplugin-syncer/ovn-kubernetes/">
          OVN Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/architecture/route-agent/" title="Route Agent" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/architecture/route-agent/">
          Route Agent
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/" title="Quickstart Guides" class="dd-item 
        parent
        
        
        ">
      <a href="/getting-started/quickstart/">
          Quickstart Guides
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/kind/" title="Sandbox Environment (kind)" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/kind/">
          Sandbox Environment (kind)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/k3s/" title="K3s" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/k3s/">
          K3s
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/managed-kubernetes/" title="Managed Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/managed-kubernetes/">
          Managed Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/managed-kubernetes/gke/" title="Google (GKE)" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/managed-kubernetes/gke/">
          Google (GKE)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/managed-kubernetes/rancher/" title="Rancher" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/managed-kubernetes/rancher/">
          Rancher
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/" title="OpenShift" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/">
          OpenShift
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/aws/" title="On AWS" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/aws/">
          On AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/globalnet/" title="On AWS with Globalnet" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/globalnet/">
          On AWS with Globalnet
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/azure/" title="On Azure" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/azure/">
          On Azure
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/gcp-lb/" title="On GCP (LoadBalancer mode)" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/gcp-lb/">
          On GCP (LoadBalancer mode)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/vsphere-aws/" title="Hybrid vSphere and AWS" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/vsphere-aws/">
          Hybrid vSphere and AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/openshift/rhos/" title="Hybrid OpenStack and AWS" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/quickstart/openshift/rhos/">
          Hybrid OpenStack and AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/getting-started/quickstart/external/" title="External Network (Experimental)" class="dd-item 
        parent
        active
        
        ">
      <a href="/getting-started/quickstart/external/">
          External Network (Experimental)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/operations/" title="Operations" class="dd-item 
        
        
        
        ">
      <a href="/operations/">
          <b>2. </b>Operations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/operations/deployment/" title="Deployment" class="dd-item 
        
        
        
        ">
      <a href="/operations/deployment/">
          Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/operations/deployment/subctl/" title="subctl" class="dd-item 
        
        
        
        ">
      <a href="/operations/deployment/subctl/">
          subctl
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/deployment/helm/" title="Helm" class="dd-item 
        
        
        
        ">
      <a href="/operations/deployment/helm/">
          Helm
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/deployment/calico/" title="Calico CNI" class="dd-item 
        
        
        
        ">
      <a href="/operations/deployment/calico/">
          Calico CNI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/usage/" title="User Guide" class="dd-item 
        
        
        
        ">
      <a href="/operations/usage/">
          User Guide
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/monitoring/" title="Monitoring" class="dd-item 
        
        
        
        ">
      <a href="/operations/monitoring/">
          Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/nat-traversal/" title="NAT Traversal" class="dd-item 
        
        
        
        ">
      <a href="/operations/nat-traversal/">
          NAT Traversal
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/troubleshooting/" title="Troubleshooting" class="dd-item 
        
        
        
        ">
      <a href="/operations/troubleshooting/">
          Troubleshooting
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/known-issues/" title="Known Issues" class="dd-item 
        
        
        
        ">
      <a href="/operations/known-issues/">
          Known Issues
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/operations/cleanup/" title="Uninstalling Submariner" class="dd-item 
        
        
        
        ">
      <a href="/operations/cleanup/">
          Uninstalling Submariner
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/community/" title="Community" class="dd-item 
        
        
        
        ">
      <a href="/community/">
          <b>3. </b>Community
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/community/code-of-conduct/" title="Code of Conduct" class="dd-item 
        
        
        
        ">
      <a href="/community/code-of-conduct/">
          Code of Conduct
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/community/contributor-roles/" title="Contributor Roles" class="dd-item 
        
        
        
        ">
      <a href="/community/contributor-roles/">
          Contributor Roles
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/community/getting-help/" title="Getting Help" class="dd-item 
        
        
        
        ">
      <a href="/community/getting-help/">
          Getting Help
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/community/releases/" title="Releases" class="dd-item 
        
        
        
        ">
      <a href="/community/releases/">
          Releases
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/community/roadmap/" title="Roadmap" class="dd-item 
        
        
        
        ">
      <a href="/community/roadmap/">
          Roadmap
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/development/" title="Development" class="dd-item 
        
        
        
        ">
      <a href="/development/">
          <b>4. </b>Development
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/development/backports/" title="Backports" class="dd-item 
        
        
        
        ">
      <a href="/development/backports/">
          Backports
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/building-testing/" title="Building and Testing" class="dd-item 
        
        
        
        ">
      <a href="/development/building-testing/">
          Building and Testing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/development/building-testing/ci-maintenance/" title="CI/CD Maintenance" class="dd-item 
        
        
        
        ">
      <a href="/development/building-testing/ci-maintenance/">
          CI/CD Maintenance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/code-review/" title="Code Review Guide" class="dd-item 
        
        
        
        ">
      <a href="/development/code-review/">
          Code Review Guide
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/contribution-guide/" title="Contributing to the Project" class="dd-item 
        
        
        
        ">
      <a href="/development/contribution-guide/">
          Contributing to the Project
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/website/" title="Contributing to the Website" class="dd-item 
        
        
        
        ">
      <a href="/development/website/">
          Contributing to the Website
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/development/website/style-guide/" title="Docs Style Guide" class="dd-item 
        
        
        
        ">
      <a href="/development/website/style-guide/">
          Docs Style Guide
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/licenses/" title="Licenses" class="dd-item 
        
        
        
        ">
      <a href="/development/licenses/">
          Licenses
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/release-process/" title="Release Process" class="dd-item 
        
        
        
        ">
      <a href="/development/release-process/">
          Release Process
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/security/" title="Security" class="dd-item 
        
        
        
        ">
      <a href="/development/security/">
          Security
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/development/security/reporting/" title="Security Reporting" class="dd-item 
        
        
        
        ">
      <a href="/development/security/reporting/">
          Security Reporting
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/security/containers/" title="Container Requirements" class="dd-item 
        
        
        
        ">
      <a href="/development/security/containers/">
          Container Requirements
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/security/secrets/" title="Secrets" class="dd-item 
        
        
        
        ">
      <a href="/development/security/secrets/">
          Secrets
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/shipyard/" title="Working with Shipyard" class="dd-item 
        
        
        
        ">
      <a href="/development/shipyard/">
          Working with Shipyard
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/development/shipyard/settings/" title="Customizing Deployments" class="dd-item 
        
        
        
        ">
      <a href="/development/shipyard/settings/">
          Customizing Deployments
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/shipyard/targets/" title="Shared Targets" class="dd-item 
        
        
        
        ">
      <a href="/development/shipyard/targets/">
          Shared Targets
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/development/shipyard/images/" title="Image Related Targets" class="dd-item 
        
        
        
        ">
      <a href="/development/shipyard/images/">
          Image Related Targets
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/other-resources/" title="Other Resources" class="dd-item 
        
        
        
        ">
      <a href="/other-resources/">
          <b>5. </b>Other Resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/submariner-io/"><i class='fab fa-fw fa-github'></i> GitHub</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://kubernetes.slack.com/archives/C010RJV694M"><i class='fab fa-fw fa-slack'></i> Slack</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://bit.ly/submariner-users"><i class='fas fa-fw fa-envelope'></i> User mailing list</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://bit.ly/submariner-dev"><i class='fas fa-fw fa-envelope'></i> Devel mailing list</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.youtube.com/channel/UCZ3brSgl2v4boglZoeChClQ/videos"><i class='fas fa-fw fa-video'></i> YouTube</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://twitter.com/submarinerio"><i class='fab fa-fw fa-twitter'></i> Twitter</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://calendar.google.com/calendar?cid=NHFuZGVoOGY0bzZ1ajlvZnBsczh1NWNlZ2tAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ"><i class='fas fa-fw fa-calendar'></i> Google Calendar</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <center>
    
    <a class="github-button" href="https://github.com/submariner-io/releases/releases" data-icon="octicon-cloud-download" aria-label="Download Submariner/subctl on github">Download</a>

    
    <a class="github-button" href="https://github.com/submariner-io/submariner" data-icon="octicon-star" data-show-count="true" aria-label="Star submariner-io/submariner on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/submariner-io/submariner/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork submariner-io/submariner on GitHub">Fork</a>

    <p>Copyright © The Submariner Contributors</p>

    <p>The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a></p>

    <p><a href="https://www.cncf.io">
        <img class="cncf-logo" src="https://raw.githubusercontent.com/cncf/artwork/master/other/cncf/horizontal/white/cncf-white.svg" alt="Cloud Native Computing Foundation">
    </a>
    Submariner is a <a href="https://www.cncf.io">Cloud Native Computing Foundation</a> sandbox project.</p>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/submariner-io/website/edit/devel/src/content/getting-started/quickstart/external/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/getting-started/'>Getting Started</a> > <a href='/getting-started/quickstart/'>Quickstart Guides</a> > External Network (Experimental)
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#setup-submariner">Setup Submariner</a></li>
        <li><a href="#set-up-non-cluster-hosts">Set up non-cluster hosts</a></li>
        <li><a href="#verify-deployment">Verify Deployment</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              External Network (Experimental)
            </h1>
          

        




	<p>This guide covers experimenting with the external network use case.
In this use case, pods running in a Kubernetes cluster can access external applications outside of the cluster and vice versa
by using DNS resolution supported by Lighthouse or manually using the Globalnet ingress IPs.
In addition to providing connectivity, the source IP of traffic is also preserved.</p>

<div class="notices warning" ><p><strong>This feature is experimental.</strong> The configuration mechanism and observed behavior may change.</p>
</div>

<h3 id="prerequisites">Prerequisites</h3>
<ol>
<li>
<p>Prepare:</p>
<ul>
<li>Two or more Kubernetes clusters</li>
<li>One or more non-cluster hosts that exist in the same network segment to one of the Kubernetes clusters</li>
</ul>
<p>In this guide, we will use the following Kubernetes clusters and non-cluster host.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>IP</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cluster-a</td>
<td>192.168.122.26</td>
<td>Single-node cluster</td>
</tr>
<tr>
<td>cluster-b</td>
<td>192.168.122.27</td>
<td>Single-node cluster</td>
</tr>
<tr>
<td>test-vm</td>
<td>192.168.122.142</td>
<td>Linux host</td>
</tr>
</tbody>
</table>
<p>In this example, everything is deployed in the 192.168.122.0/24 segment.
However, it is only required that cluster-a and test-vm are in the same segment.
Other clusters, cluster-b and any additional clusters, can be deployed in different segments or even in any other networks in the internet.
Also, clusters can be multi-node clusters.</p>
<p>Subnets of non-cluster hosts should be distinguished from those of the clusters to easily specify the external network CIDR.
In this example, cluster-a and cluster-b belong to 192.168.122.0/25 and test-vm belongs to 192.168.122.128/25.
Therefore, the external network CIDR for this configuration is 192.168.122.128/25.
In test environments with just one host, an external network CIDR like 192.168.122.142/32 can be specified.
However, design of the subnets need to be considered when more hosts are used.</p>
</li>
<li>
<p>Choose the Pod CIDR and the Service CIDR for Kubernetes clusters and deply them.</p>
<p>In this guide, we will use the following CIDRs:</p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Pod CIDR</th>
<th>Service CIDR</th>
</tr>
</thead>
<tbody>
<tr>
<td>cluster-a</td>
<td>10.42.0.0/24</td>
<td>10.43.0.0/16</td>
</tr>
<tr>
<td>cluster-b</td>
<td>10.42.0.0/24</td>
<td>10.43.0.0/16</td>
</tr>
</tbody>
</table>
<p>Note that we will use Globalnet in this guide, therefore overlapping CIDRs are supported.
One of the easiest way to create this environment will be to deploy two K3s clusters by the steps described
<a href="https://submariner.io/getting-started/quickstart/k3s/">here</a> until &ldquo;Deploy cluster-b on node-b&rdquo;,
with modifying deploy commands to just <code>curl -sfL https://get.k3s.io | sh -</code> to use default CIDR.</p>
</li>
</ol>

<div class="notices note" ><p>In this configuration, global IPs are used to access between the gateway node and non-cluster hosts,
which means packets are sent to IP addresses that are not part of the actual network segment.
To make such packets not to be dropped, anti-spoofing rules need to be disabled for the hosts and the gateway node.</p>
</div>

<h3 id="setup-submariner">Setup Submariner</h3>
<h4 id="ensure-kubeconfig-files">Ensure kubeconfig files</h4>
<p>Ensure that kubeconfig files for both clusters are available.
This guide assumes cluster-a&rsquo;s kubeconfig file is named <code>kubeconfig.cluster-a</code> and cluster-b&rsquo;s is named <code>kubeconfig.cluster-b</code>.</p>
<h4 id="install-subctl">Install <code>subctl</code></h4>
<p>Download the subctl binary and make it available on your PATH.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -Ls https://get.submariner.io | bash
export PATH<span style="color:#f92672">=</span>$PATH:~/.local/bin
echo export PATH<span style="color:#f92672">=</span><span style="color:#ae81ff">\$</span>PATH:~/.local/bin &gt;&gt; ~/.profile
</code></pre></div><p>If you have Go and the <a href="https://github.com/submariner-io/subctl">source code</a>, you can build and install subctl instead:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd go/src/submariner-io/subctl
go build -o $GOBIN/subctl github.com/submariner-io/subctl/cmd
</code></pre></div><p>(and ensure your <code>go/bin</code> directory is on your <code>PATH</code>).</p>
<h4 id="use-cluster-a-as-the-broker-with-globalnet-enabled">Use cluster-a as the Broker with Globalnet enabled</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">subctl deploy-broker --kubeconfig kubeconfig.cluster-a --globalnet
</code></pre></div><h4 id="label-gateway-nodes">Label gateway nodes</h4>
<p>When Submariner joins a cluster to the broker via the <code>subctl join</code> command, it chooses a node on which to install the
gateway by labeling it appropriately. By default, Submariner uses a worker node for the gateway; if there are no worker
nodes, then no gateway is installed unless a node is manually labeled as a gateway. Since we are deploying k3s all-in-one
nodes, there are no worker nodes, so it is necessary to label the single node as a gateway. By default, the node name is
the hostname. In this example, the hostnames are &ldquo;cluster-a&rdquo; and &ldquo;cluster-b&rdquo;, respectively.</p>
<p>Execute the following on cluster-a:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl label node cluster-a submariner.io/gateway<span style="color:#f92672">=</span>true
</code></pre></div><p>Execute the following on cluster-b:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl label node cluster-b submariner.io/gateway<span style="color:#f92672">=</span>true
</code></pre></div><h4 id="join-cluster-a-to-the-broker-with-external-cidr-added-as-cluster-cidr">Join cluster-a to the Broker with external CIDR added as cluster CIDR</h4>
<p>Carefully review the <code>CLUSTER_CIDR</code> and <code>EXTERNAL_CIDR</code> and run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CLUSTER_CIDR<span style="color:#f92672">=</span>10.42.0.0/24
EXTERNAL_CIDR<span style="color:#f92672">=</span>192.168.122.128/25
subctl join --kubeconfig kubeconfig.cluster-a broker-info.subm --clusterid cluster-a --natt<span style="color:#f92672">=</span>false --clustercidr<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>CLUSTER_CIDR<span style="color:#e6db74">}</span>,<span style="color:#e6db74">${</span>EXTERNAL_CIDR<span style="color:#e6db74">}</span>
</code></pre></div><h4 id="join-cluster-b-to-the-broker">Join cluster-b to the Broker</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">subctl join --kubeconfig kubeconfig.cluster-b broker-info.subm --clusterid cluster-b --natt<span style="color:#f92672">=</span>false
</code></pre></div><h4 id="deploy-dns-server-on-cluster-a-for-non-cluster-hosts">Deploy DNS server on cluster-a for non-cluster hosts</h4>
<p>Create a list of upstream DNS servers as <code>upstreamservers</code>:</p>
<p>Note that <code>dnsip</code> is the IP of DNS server for the test-vm, which is defined as <code>nameserver</code> in <code>/etc/resolve.conf</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnsip<span style="color:#f92672">=</span>192.168.122.1
lighthousednsip<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get svc --kubeconfig kubeconfig.cluster-a -n submariner-operator submariner-lighthouse-coredns -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.spec.clusterIP}&#39;</span><span style="color:#66d9ef">)</span>

cat <span style="color:#e6db74">&lt;&lt; EOF &gt; upstreamservers
</span><span style="color:#e6db74">server=/svc.clusterset.local/$lighthousednsip
</span><span style="color:#e6db74">server=$dnsip
</span><span style="color:#e6db74">EOF</span>
</code></pre></div><p>Create configmap of the list:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-a
kubectl create configmap external-dnsmasq -n submariner-operator --from-file<span style="color:#f92672">=</span>upstreamservers
</code></pre></div><p>Create a <code>dns.yaml</code> as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: apps/v1
<span style="color:#66d9ef">kind</span>: Deployment
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: external-dns-cluster-a
  <span style="color:#66d9ef">namespace</span>: submariner-operator
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#66d9ef">app</span>: external-dns-cluster-a
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">replicas</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">selector</span>:
    <span style="color:#66d9ef">matchLabels</span>:
      <span style="color:#66d9ef">app</span>: external-dns-cluster-a
  <span style="color:#66d9ef">template</span>:
    <span style="color:#66d9ef">metadata</span>:
      <span style="color:#66d9ef">labels</span>:
        <span style="color:#66d9ef">app</span>: external-dns-cluster-a
    <span style="color:#66d9ef">spec</span>:
      <span style="color:#66d9ef">containers</span>:
      - <span style="color:#66d9ef">name</span>: dnsmasq
        <span style="color:#66d9ef">image</span>: registry.access.redhat.com/ubi8/ubi-minimal:latest
        <span style="color:#66d9ef">ports</span>:
        - <span style="color:#66d9ef">containerPort</span>: <span style="color:#ae81ff">53</span>
        <span style="color:#66d9ef">command</span>: [ <span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;microdnf install -y dnsmasq; ln -s /upstreamservers /etc/dnsmasq.d/upstreamservers; dnsmasq -k&#34;</span> ]
        <span style="color:#66d9ef">securityContext</span>:
          <span style="color:#66d9ef">capabilities</span>:
            <span style="color:#66d9ef">add</span>: [<span style="color:#e6db74">&#34;NET_ADMIN&#34;</span>]
        <span style="color:#66d9ef">volumeMounts</span>:
        - <span style="color:#66d9ef">name</span>: upstreamservers
          <span style="color:#66d9ef">mountPath</span>: /upstreamservers
      <span style="color:#66d9ef">volumes</span>:
        - <span style="color:#66d9ef">name</span>: upstreamservers
          <span style="color:#66d9ef">configMap</span>:
            <span style="color:#66d9ef">name</span>: external-dnsmasq
---
<span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: Service
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">namespace</span>: submariner-operator
  <span style="color:#66d9ef">name</span>: external-dns-cluster-a
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">ports</span>:
  - <span style="color:#66d9ef">name</span>: udp
    <span style="color:#66d9ef">port</span>: <span style="color:#ae81ff">53</span>
    <span style="color:#66d9ef">protocol</span>: UDP
    <span style="color:#66d9ef">targetPort</span>: <span style="color:#ae81ff">53</span>
  <span style="color:#66d9ef">selector</span>:
    <span style="color:#66d9ef">app</span>: external-dns-cluster-a
</code></pre></div><p>Use this YAML to create DNS server, and assign global ingress IP:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f dns.yaml
subctl export service -n submariner-operator external-dns-cluster-a
</code></pre></div><p>Check global ingress IP:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl --kubeconfig kubeconfig.cluster-a get globalingressip external-dns-cluster-a -n submariner-operator
NAME                     IP
external-dns-cluster-a   242.0.255.251
</code></pre></div><h3 id="set-up-non-cluster-hosts">Set up non-cluster hosts</h3>
<p>Modify routing for global CIDR on test-vm:</p>
<p>Note that <code>subm_gw_ip</code> is the gateway node IP of the cluster in the same network segment of the hosts.
In the case of the example of this guide, it is the node IP of cluster-a.
Also, 242.0.0.0/8 is the default globalCIDR.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">subm_gw_ip<span style="color:#f92672">=</span>192.168.122.26
ip r add 242.0.0.0/8 via <span style="color:#e6db74">${</span>subm_gw_ip<span style="color:#e6db74">}</span>
</code></pre></div><p>To persist above configuration across reboot, check the document for each Linux distribution.
For example, on Centos 7, to set presistent route for eth0, below command is required:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;242.0.0.0/8 via </span><span style="color:#e6db74">${</span>subm_gw_ip<span style="color:#e6db74">}</span><span style="color:#e6db74"> dev eth0&#34;</span> &gt;&gt; /etc/sysconfig/network-scripts/route-eth0
</code></pre></div><p>Modify <code>/etc/resolv.conf</code> to change DNS server for the host on test-vm:</p>
<p>For example)</p>
<ul>
<li>Before:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nameserver 192.168.122.1
</code></pre></div><ul>
<li>After:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nameserver 242.0.255.251
</code></pre></div><p>Check that the DNS server itself can be resolved:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nslookup external-dns-cluster-a.submariner-operator.svc.clusterset.local
Server:         242.0.255.251
Address:        242.0.255.251#53

Name:   external-dns-cluster-a.submariner-operator.svc.clusterset.local
Address: 10.43.162.46
</code></pre></div><h3 id="verify-deployment">Verify Deployment</h3>
<h4 id="verify-manually">Verify Manually</h4>
<h5 id="deploy-http-server-on-hosts">Deploy HTTP server on hosts</h5>
<p>Run on test-vm:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Python 2.x:</span>
python -m SimpleHTTPServer <span style="color:#ae81ff">80</span>
<span style="color:#75715e"># Python 3.x:</span>
python -m http.server <span style="color:#ae81ff">80</span>
</code></pre></div><h5 id="verify-access-to-external-hosts-from-clusters">Verify access to External hosts from clusters</h5>
<p>Create Service, Endpoints, ServiceExport to access the test-vm from cluster-a:</p>
<p>Note that <code>Endpoints.subsets.addresses</code> needs to be modified to IP of test-vm.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-a
cat <span style="color:#e6db74">&lt;&lt; EOF | kubectl apply -f -
</span><span style="color:#e6db74">apiVersion: v1
</span><span style="color:#e6db74">kind: Service
</span><span style="color:#e6db74">metadata:
</span><span style="color:#e6db74">  name: test-vm
</span><span style="color:#e6db74">spec:
</span><span style="color:#e6db74">  ports:
</span><span style="color:#e6db74">    - protocol: TCP
</span><span style="color:#e6db74">      port: 80
</span><span style="color:#e6db74">      targetPort: 80
</span><span style="color:#e6db74">EOF</span>

cat <span style="color:#e6db74">&lt;&lt; EOF | kubectl apply -f -
</span><span style="color:#e6db74">apiVersion: v1
</span><span style="color:#e6db74">kind: Endpoints
</span><span style="color:#e6db74">metadata:
</span><span style="color:#e6db74">  name: test-vm
</span><span style="color:#e6db74">subsets:
</span><span style="color:#e6db74">  - addresses:
</span><span style="color:#e6db74">      - ip: 192.168.122.142
</span><span style="color:#e6db74">    ports:
</span><span style="color:#e6db74">      - port: 80
</span><span style="color:#e6db74">EOF</span>

subctl export service -n default test-vm
</code></pre></div><p>Check global ingress IP for test-vm, on cluster-a:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get globalingressip test-vm
NAME      IP
test-vm   242.0.255.253
</code></pre></div><p>Verify access to test-vm from clusters:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-a
kubectl -n default run tmp-shell --rm -i --tty --image quay.io/submariner/nettest -- bash
curl 242.0.255.253
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-b
kubectl -n default run tmp-shell --rm -i --tty --image quay.io/submariner/nettest -- bash
curl 242.0.255.253
</code></pre></div><p>On test-vm, check the console log of HTTP server that there are accesses from pods</p>

<div class="notices note" ><p>Currently, <strong>headless</strong> service without selector is not supported for Globalnet,
therefore service without selector needs to be used.
This feature is under discussion in <a href="https://github.com/submariner-io/submariner/issues/1537">#1537</a>.</p>
</div>


<div class="notices note" ><p>Currently, DNS resolution for service without selector is not supported,
therefore global IPs need to be used to access to the external hosts.
This feature is under discussion in <a href="https://github.com/submariner-io/lighthouse/issues/603">#603</a>.
Note that there is a workaround to make it resolvable by manually creating endpointslice, as described <a href="https://github.com/submariner-io/lighthouse/issues/603#issuecomment-901944297">here</a>.</p>
</div>

<h5 id="verify-access-to-deployment-from-non-cluster-hosts">Verify access to Deployment from non-cluster hosts</h5>
<p>Create Deployment in cluster-b:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-b
kubectl -n default create deployment nginx --image<span style="color:#f92672">=</span>k8s.gcr.io/nginx-slim:0.8
kubectl -n default expose deployment nginx --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
subctl export service --namespace default nginx
</code></pre></div><p>From test-vm, verify access:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl nginx.default.svc.clusterset.local
</code></pre></div><p>Check the console log of HTTP server that there is access from test-vm:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl logs -l app<span style="color:#f92672">=</span>nginx
</code></pre></div><h5 id="verify-access-to-statefulset-from-non-cluster-hosts">Verify access to Statefulset from non-cluster hosts</h5>
<p>A <code>StatefulSet</code> uses a headless <code>Service</code>. Create a <code>web.yaml</code> file as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: Service
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: nginx-ss
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#66d9ef">app.kubernetes.io/instance</span>: nginx-ss
    <span style="color:#66d9ef">app.kubernetes.io/name</span>: nginx-ss
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">ports</span>:
  - <span style="color:#66d9ef">port</span>: <span style="color:#ae81ff">80</span>
    <span style="color:#66d9ef">name</span>: web
  <span style="color:#66d9ef">clusterIP</span>: None
  <span style="color:#66d9ef">selector</span>:
    <span style="color:#66d9ef">app.kubernetes.io/instance</span>: nginx-ss
    <span style="color:#66d9ef">app.kubernetes.io/name</span>: nginx-ss
---
<span style="color:#66d9ef">apiVersion</span>: apps/v1
<span style="color:#66d9ef">kind</span>: StatefulSet
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: web
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">serviceName</span>: <span style="color:#e6db74">&#34;nginx-ss&#34;</span>
  <span style="color:#66d9ef">replicas</span>: <span style="color:#ae81ff">2</span>
  <span style="color:#66d9ef">selector</span>:
    <span style="color:#66d9ef">matchLabels</span>:
        <span style="color:#66d9ef">app.kubernetes.io/instance</span>: nginx-ss
        <span style="color:#66d9ef">app.kubernetes.io/name</span>: nginx-ss
  <span style="color:#66d9ef">template</span>:
    <span style="color:#66d9ef">metadata</span>:
      <span style="color:#66d9ef">labels</span>:
        <span style="color:#66d9ef">app.kubernetes.io/instance</span>: nginx-ss
        <span style="color:#66d9ef">app.kubernetes.io/name</span>: nginx-ss
    <span style="color:#66d9ef">spec</span>:
      <span style="color:#66d9ef">containers</span>:
      - <span style="color:#66d9ef">name</span>: nginx-ss
        <span style="color:#66d9ef">image</span>: k8s.gcr.io/nginx-slim:<span style="color:#ae81ff">0.8</span>
        <span style="color:#66d9ef">ports</span>:
        - <span style="color:#66d9ef">containerPort</span>: <span style="color:#ae81ff">80</span>
          <span style="color:#66d9ef">name</span>: web
</code></pre></div><p>Apply the above YAML to create a web <code>StatefulSet</code> with nginx-ss as the headless service:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-b
kubectl -n default apply -f web.yaml
subctl export service -n default nginx-ss
</code></pre></div><p>From test-vm, verify access:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl nginx-ss.default.svc.clusterset.local
curl cluster-b.nginx-ss.default.svc.clusterset.local
curl web-0.cluster-b.nginx-ss.default.svc.clusterset.local
curl web-1.cluster-b.nginx-ss.default.svc.clusterset.local
</code></pre></div><p>Check the console log of the HTTP server to verify there are accesses from test-vm:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl logs web-0
kubectl logs web-1
</code></pre></div><h5 id="verify-source-ip-of-the-access-from-statefulset">Verify source IP of the access from Statefulset</h5>
<p>Confirm the global egress IPs for each pod managed by Statefulset:</p>
<ul>
<li>From Cluster:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-b
kubectl get globalingressip | grep web
pod-web-0     242.1.255.251
pod-web-1     242.1.255.250
</code></pre></div><ul>
<li>From Hosts:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nslookup web-0.cluster-b.nginx-ss.default.svc.clusterset.local
Server:         242.0.255.251
Address:        242.0.255.251#53

Name:   web-0.cluster-b.nginx-ss.default.svc.clusterset.local
Address: 242.1.255.251

nslookup web-1.cluster-b.nginx-ss.default.svc.clusterset.local
Server:         242.0.255.251
Address:        242.0.255.251#53

Name:   web-1.cluster-b.nginx-ss.default.svc.clusterset.local
Address: 242.1.255.250
</code></pre></div><p>Verify the source IP of each access from each pod to test-vm is the same to its global egress IP:</p>
<ul>
<li>Access from web-0</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-b
kubectl exec -it web-0 -- bash
curl 242.0.255.253
exit
</code></pre></div><ul>
<li>Access from web-1</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export KUBECONFIG<span style="color:#f92672">=</span>kubeconfig.cluster-b
kubectl exec -it web-1 -- bash
curl 242.0.255.253
exit
</code></pre></div><ul>
<li>Check the console log in test-vm</li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/getting-started/quickstart/openshift/rhos/" title="Hybrid OpenStack and AWS"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/operations/" title="Operations" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1665163724"></script>
    <script src="/js/perfect-scrollbar.min.js?1665163724"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1665163724"></script>
    <script src="/js/jquery.sticky.js?1665163724"></script>
    <script src="/js/featherlight.min.js?1665163724"></script>
    <script src="/js/highlight.pack.js?1665163724"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1665163724"></script>
    <script src="/js/learn.js?1665163724"></script>
    <script src="/js/hugo-learn.js?1665163724"></script>

    <link href="/mermaid/mermaid.css?1665163724" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1665163724"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
